<!DOCTYPE HTML>
<html>
<head lang="en">
<meta charset="UTF-8"/>
<!--<link href="favicon.ico" rel="shortcut icon" type="image/x-icon" />-->
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1"/>
<meta http-equiv="content-type" content="text/html" />
<meta name="author" content="npool.pw" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.1.1/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.1.1/js/bootstrap.min.js"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Inconsolata" rel="stylesheet" type="text/css">
<script src="config.js"></script>
<title>Pool List</title>
<style>
@import url(https://fonts.googleapis.com/css?family=Roboto+Condensed:400,700);
@import url(https://fonts.googleapis.com/css?family=Roboto:400,300,500);

body {
    font-size: 14px;
    line-height: 1.428571429;
    color: #6f6e6e;
    font-family: 'Roboto', Helvetica, Arial, sans-serif;
    padding-top: 65px;
    padding-bottom: 80px;
    overflow-y: scroll;
    color: #555555;
    background-color: #ffffff;
}
.table > thead > tr > th{
    color: #555555;
    border-bottom-color: #cccccc;
}
.table > tbody > tr > td {
    border-top-color: #c9e0e9;
}
#network_rows > tr > td{
    vertical-align: middle;
    font-family: 'Inconsolata', monospace;
    font-size: 0.95em;
}
</style>
</head>
<body>
<div class="container">
  <div class="table-responsive">
      <table class="table table-hover">
          <thead>
          <tr>
              <th><i class="fa fa-bars"></i> Coin</th>
              <th><i class="fa fa-tachometer"></i> Hashrate</th>
              <th><i class="fa fa-users"></i> Connected Miners</th>
              <th><i class="fa fa-gavel"></i> Connected Workers</th>
              <th><i class="fa fa-clock-o"></i> Last Block Found</th>
          </tr>
          </thead>
          <tbody id="rows">

          </tbody>
      </table>
  </div>
</div>
<script type="text/javascript">
    function networkStat()
    {
        const NETWORK_STAT_MAP = new Map(listPool);
        NETWORK_STAT_MAP.forEach((url, host, coin, map) => {
            $.getJSON(url + '/stats', (data, textStatus, jqXHR) => {
                updateText('hashrate-'+coin, getReadableHashRateString(data.pool.hashrate)+'/s');
                updateText('miners-'+coin, data.pool.miners);
                updateText('lastBlockFound-'+coin, new Date(parseInt(data.pool.lastBlockFound)).toLocaleString());
            });
        });
    }
    
    function updateText(elementId, text){
        var el = document.getElementById(elementId);
        if (el.textContent !== text){
            el.textContent = text;
        }
        return el;
    }
    
    function getReadableHashRateString(hashrate){
        var i = 0;
        var byteUnits = [' H', ' KH', ' MH', ' GH', ' TH', ' PH' ];
        while (hashrate > 1000){
            hashrate = hashrate / 1000;
            i++;
        }
        return hashrate.toFixed(2) + byteUnits[i];
    }
    
    for(pool in listPool)
    {
        console.log(pool);
        $.getJSON(pool[2] + '/stats', (data, textStatus, jqXHR) => {
            $('#rows').append('<tr>' +
                '<td id=coin-'+pool[0]+'><a target="_blank" href='+pool[1]+'>'+pool[0]+'</a></td>' +
                '<td id=hashrate-'+pool[0]+'>'+getReadableHashRateString(data.pool.hashrate)+'/s'+'</td>' +
                '<td id=miners-'+pool[0]+'>'+data.pool.miners+'</td>' +
                '<td id=lastBlockFound-'+pool[0]+'>'+new Date(parseInt(data.pool.lastBlockFound)).toLocaleString()+'</td>' +
            '</tr>');
        });
    }
</script>
</body>
</html>
